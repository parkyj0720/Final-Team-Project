<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper 
  PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" 
  "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="CoXml">

	<resultMap type="CommunityModel.CommunityDto" id="Comm">
		<result property="asd" column="asd"
			jdbcType="LONGVARCHAR" javaType="java.lang.String"
			typeHandler="LongHandler.CLOBHandler" />
	</resultMap>
	<resultMap type="CommunityModel.Comment" id="nity">
		<result property="asd" column="asd"
			jdbcType="LONGVARCHAR" javaType="java.lang.String"
			typeHandler="LongHandler.CLOBHandler" />
	</resultMap>


	<!-- 입력 -->
	<select id="Get_boardlist" resultType="CommunityModel.BoardList">
		select *
		from BOARD_CAT_T
	</select>

	<!-- 메인화면 리스트 -->
	<select id="Main" parameterType="int"
		resultType="CommunityModel.CommunityDto">
		select BRD_IDX,
		BRD_TIT,
		BRD_WRT_ID,
		BRD_SYSDATE,

		BRD_VIEWS,
		CATEGORY_IDX
		from BOARD_T 
		where
		CATEGORY_IDX = #{num}
		ORDER BY BRD_IDX DESC
		limit 7
	</select>

	<!-- 리스트 -->
	<select id="List" parameterType="int"
		resultType="CommunityModel.CommunityDto">
		select BRD_IDX,
		BRD_TIT,
		BRD_WRT_ID,
		BRD_SYSDATE,

		BRD_VIEWS,
		CATEGORY_IDX
		from BOARD_T 
		where
		CATEGORY_IDX = #{num}
		ORDER BY BRD_IDX DESC
	</select>

	<!-- 보드하나만 선택 -->
	<select id="one_board" parameterType="int"
		resultType="CommunityModel.BoardList">
		select *
		from BOARD_CAT_T where BRD_CAT_IDX = #{num}
	</select>
	
	<!-- 좋아요 -->
	<select id="list_heart" parameterType="int"
		resultType="CommunityModel.Heart">
		select *
		from HEART_T 
		where BOARD_IDX = #{num}
	</select>

	<!-- 디테일 게시글 -->
	<select id="detail" parameterType="int"
		resultType="CommunityModel.CommunityDto" resultMap="Comm">
		select
		BRD_IDX,
		BRD_TIT,
		BRD_WRT_ID,
		BRD_SYSDATE,
		BRD_VIEWS,
		CATEGORY_IDX,
		BRD_CONTENT
		from community 
		where (BRD_IDX = #{num})
	</select>
	
	<!-- 디테일 좋아요 -->
	<select id="detail_heart" parameterType="int"
		resultType="CommunityModel.Heart">
		select 
		*
		from HEART_T
		where BOARD_IDX = #{num}
	</select>
	<select id="delete_heart" parameterType="CommunityModel.Heart">
		delete
		from HEART_T 
		where BOARD_IDX=#{BOARD_IDX}
		and MEM_IDX = #{MEM_IDX}
	</select>
	<select id="insert_heart" parameterType="CommunityModel.Heart">
		insert
		into HEART_T
		values(
		#{BOARD_IDX},
		#{MEM_IDX})
	</select>
	
	<!-- 디테일 댓글 -->
	<select id="detail_comments" parameterType="int"
		resultType="CommunityModel.Comment" resultMap="nity">
		select
		MEM_IDX,
		COMT_SYSDATE,
		BRD_IDX,
		COMT_CONTENT
		from COMMENT_T
		where BRD_IDX = #{num}
	</select>
	
	<!-- 디테일 조회수 증가 -->
	<select id="view" parameterType="int">
		update BOART_T set BRD_VIEWS = BRD_VIEWS + 1 where BRD_IDX=#{BRD_IDX}
	</select>


	<!-- 게시글 작성 -->
	<insert id="insert" parameterType="CommunityModel.CommunityDto">
		insert into BOARD_T
		(
		BRD_TIT,
		BRD_WRT_ID,
		BRD_VIEWS,
		CATEGORY_IDX,
		BRD_CONTENT)

		values(
		#{BRD_TIT},
		#{BRD_WRT_ID},
		0,
		#{CATEGORY_IDX},
		#{BRD_CONTENT})
	</insert>
	
	<delete id="delete_content_comments" parameterType="int">
		delete from comments where content_num=#{num}
	</delete>
	<delete id="delete_content_heart" parameterType="int">
		delete from heart where content_num=#{num}
	</delete>
	<delete id="delete_content" parameterType="int">
		delete from community where num=#{num}
	</delete>
	<insert id="insert_comment" parameterType="CommunityModel.Comment">
		insert into comments
		values(
		#{writer_id},
		sysdate,
		#{content},
		#{content_num}
		)
	</insert>

</mapper>